function handler(a,b){S.log({},"http request: "+a.url);var c=a.url,d={"/":"../client/index.html","/game.js":"../client/game.js","/style.css":"../client/style.css","/monHead.svg":"../client/monHead.svg","/monMouth.svg":"../client/monMouth.svg","/nomHead.svg":"../client/nomHead.svg","/nomMouth.svg":"../client/nomMouth.svg","/eat.svg":"../eat.svg"};return 0==c.indexOf("/?")&&(c="/"),d[c]?void fs.readFile(d[c],function(a,c){return a?(S.log({}," 404 not found"),b.writeHead(404),void b.end("not found")):(S.log({},"  200 found"),b.writeHead(200),b.end(c))}):(S.log({}," 302 redirecting"),b.writeHead(302,{Location:"/"}),void b.end())}var http=require("http"),app=require("http").createServer(handler),io=require("socket.io").listen(app,{log:!1}),fs=require("fs"),S={games:[],browsing_sockets:[],waiting_socket:null,get_registered_games:function(){for(var a=[],b=0;b<this.games.length;b++)a.push(this.games[b].name);return a}};S.log=function(a,b){},io.sockets.on("connection",function(a){S.log(a,"connected"),a.on("lets_play",function(b){S.waiting_socket?(a.opponent=S.waiting_socket,S.waiting_socket.opponent=a,S.waiting_socket=null,a.emit("game_start",{game_host:!1}),a.opponent.emit("game_start",{game_host:!0})):S.waiting_socket=a}),a.on("game_update",function(b){a.opponent.emit("game_update",b)}),a.on("game_update_both",function(b){a.opponent.emit("game_update",b),a.emit("game_update",b)}),a.on("register_game",function(b){console.log("registered game:"+b.name),S.games.push({name:b.name,socket:a});for(var c=0;c<S.browsing_sockets.length;c++)S.browsing_sockets[c].emit("registered_games",S.get_registered_games())}),a.on("unregister_game",function(a){for(var b=0;b<S.games.length;b++)if(a.name==S.games[b].name){S.games.splice(b,1);for(var c=0;c<S.browsing_sockets.length;c++)S.browsing_sockets[c].emit("registered_games",S.get_registered_games());break}}),a.on("get_registered_games",function(b){S.browsing_sockets.push(a),console.log("REGISTERED GAMES:"+S.get_registered_games()),a.emit("registered_games",S.get_registered_games())}),a.on("stop_browsing",function(b){for(var c=0;c<S.browsing_sockets.length;c++)if(a==S.browsing_sockets[c]){S.browsing_sockets.splice(c,1);break}}),a.on("join_game",function(b){console.log(b.name);for(var c=0;c<S.games.length;c++)if(S.games[c].name==b.name){var d=S.games.splice(c,1)[0];d.socket.opponent=a,a.opponent=d.socket;for(var e=0;e<S.browsing_sockets.length;e++)S.browsing_sockets[e].emit("registered_games",S.get_registered_games()),S.browsing_sockets[e]==a&&(S.browsing_sockets.splice(e,1),e--);d.socket.emit("game_start",{game_host:!0}),a.emit("game_start",{game_host:!1});break}}),a.on("left_game",function(b){a.opponent.emit("left_game",b)}),a.on("lets_rematch",function(b){a.ready_for_rematch=!0,a.opponent.ready_for_rematch&&(a.ready_for_rematch=!1,a.opponent.ready_for_rematch=!1,a.emit("do_rematch",{}),a.opponent.emit("do_rematch",{}))})}),app.listen(8e3),console.log("Ready!");